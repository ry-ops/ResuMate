<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Documents Generator - ResuMate</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/navigation.css">
    <style>
        /* Light Theme (default) */
        :root, [data-theme="light"] {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;

            /* Theme-specific colors */
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --card-bg: #ffffff;
            --card-header-bg: var(--primary);
            --card-header-text: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --text-muted: #95a5a6;
            --input-bg: #ffffff;
            --input-border: #e0e0e0;
            --input-text: #2c3e50;
            --output-bg: #f8f9fa;
            --tag-bg: #ecf0f1;
            --option-card-bg: #ffffff;
            --option-card-selected: rgba(52,152,219,0.1);
            --api-section-bg: #ecf0f1;
            --success-bg: #d4edda;
            --success-text: #155724;
            --success-border: #c3e6cb;
            --error-bg: #f8d7da;
            --error-text: #721c24;
            --error-border: #f5c6cb;
            --shadow-color: rgba(0,0,0,0.2);
            --tab-bg: rgba(255,255,255,0.2);
            --tab-border: rgba(255,255,255,0.3);
            --tab-text: #ffffff;
            --tab-active-bg: #ffffff;
            --tab-active-text: var(--primary);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --primary: #5dade2;
            --secondary: #3498db;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #2d3436;
            --dark: #ecf0f1;

            /* Theme-specific colors */
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --card-bg: #1e272e;
            --card-header-bg: #2d3436;
            --card-header-text: #ecf0f1;
            --text-primary: #ecf0f1;
            --text-secondary: #b2bec3;
            --text-muted: #636e72;
            --input-bg: #2d3436;
            --input-border: #4a5568;
            --input-text: #ecf0f1;
            --output-bg: #2d3436;
            --tag-bg: #4a5568;
            --option-card-bg: #2d3436;
            --option-card-selected: rgba(93,173,226,0.2);
            --api-section-bg: #2d3436;
            --success-bg: #1e4620;
            --success-text: #82e089;
            --success-border: #2d5a30;
            --error-bg: #4a1c1c;
            --error-text: #f5a5a5;
            --error-border: #6b2c2c;
            --shadow-color: rgba(0,0,0,0.4);
            --tab-bg: rgba(0,0,0,0.3);
            --tab-border: rgba(255,255,255,0.1);
            --tab-text: #ecf0f1;
            --tab-active-bg: #2d3436;
            --tab-active-text: #5dade2;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            transition: background 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: var(--tab-bg);
            border: 2px solid var(--tab-border);
            border-radius: 30px;
            color: var(--tab-text);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .tab-btn.active {
            background: var(--tab-active-bg);
            color: var(--tab-active-text);
            border-color: var(--tab-active-bg);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 40px var(--shadow-color);
            overflow: hidden;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        .card-header {
            background: var(--card-header-bg);
            color: var(--card-header-text);
            padding: 20px 25px;
            transition: background 0.3s ease;
        }

        .card-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .card-header p {
            margin: 5px 0 0;
            opacity: 0.8;
            font-size: 0.95em;
        }

        .card-body {
            padding: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 1em;
            background: var(--input-bg);
            color: var(--input-text);
            transition: border-color 0.3s, box-shadow 0.3s, background 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            min-height: 50px;
            background: var(--input-bg);
            transition: background 0.3s ease, border-color 0.3s ease;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: var(--tag-bg);
            color: var(--text-primary);
            border-radius: 20px;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .tag button {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.1em;
            padding: 0;
            line-height: 1;
        }

        .add-tag-input {
            border: none !important;
            padding: 5px !important;
            flex: 1;
            min-width: 120px;
            box-shadow: none !important;
            background: transparent !important;
            color: var(--input-text) !important;
        }

        .add-tag-input::placeholder {
            color: var(--text-muted);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102,126,234,0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--tag-bg);
            color: var(--text-primary);
            transition: background 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--input-border);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .output-section {
            margin-top: 30px;
            display: none;
        }

        .output-section.visible {
            display: block;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .output-header h3 {
            margin: 0;
            color: var(--primary);
        }

        .output-content {
            background: var(--output-bg);
            border: 2px solid var(--input-border);
            border-radius: 8px;
            padding: 20px;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 1em;
            color: var(--text-primary);
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .word-count {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            color: var(--dark);
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--light);
            border-top-color: var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.success {
            background: var(--success-bg);
            color: var(--success-text);
            border: 1px solid var(--success-border);
            display: block;
        }

        .status-message.error {
            background: var(--error-bg);
            color: var(--error-text);
            border: 1px solid var(--error-border);
            display: block;
        }

        .option-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-card {
            padding: 15px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            background: var(--option-card-bg);
            transition: all 0.3s ease;
        }

        .option-card:hover {
            border-color: var(--secondary);
        }

        .option-card.selected {
            border-color: var(--secondary);
            background: var(--option-card-selected);
        }

        .option-card h4 {
            margin: 0 0 5px;
            color: var(--primary);
        }

        .option-card p {
            margin: 0;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .api-key-section {
            background: var(--api-section-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            transition: background 0.3s ease;
        }

        .api-key-section h3 {
            margin-top: 0;
            color: var(--primary);
        }

        /* Job Import Section */
        .job-import-section {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            color: white;
        }

        .job-import-section h3 {
            margin-top: 0;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .job-import-section p {
            opacity: 0.9;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .job-url-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .job-url-input-group input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            font-size: 1em;
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .job-url-input-group input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .job-url-input-group input:focus {
            outline: none;
            border-color: white;
            background: rgba(255,255,255,0.2);
        }

        .job-url-input-group button {
            padding: 12px 24px;
            border: 2px solid white;
            border-radius: 8px;
            background: white;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .job-url-input-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .job-url-input-group button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .supported-sites {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .supported-sites span {
            font-size: 0.8em;
            padding: 4px 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
        }

        .job-preview {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .job-preview.visible {
            display: block;
        }

        .job-preview h4 {
            margin: 0 0 10px;
            color: white;
        }

        .job-preview-content {
            font-size: 0.9em;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
        }

        .job-preview-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .job-preview-actions button {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .job-preview-actions .btn-use {
            background: var(--success);
            color: white;
        }

        .job-preview-actions .btn-clear {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .job-data-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            background: var(--success);
            color: white;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .job-data-badge button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            margin-left: 5px;
            font-size: 1.1em;
        }

        /* Text paste alternative */
        .paste-text-toggle {
            color: rgba(255,255,255,0.8);
            font-size: 0.85em;
            cursor: pointer;
            text-decoration: underline;
            background: none;
            border: none;
            margin-top: 10px;
        }

        .paste-text-area {
            display: none;
            margin-top: 15px;
        }

        .paste-text-area.visible {
            display: block;
        }

        .paste-text-area textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 0.95em;
            resize: vertical;
        }

        .paste-text-area textarea::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .inline-form {
            display: flex;
            gap: 10px;
        }

        .inline-form input {
            flex: 1;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body id="main-content" tabindex="-1">
    <div class="container">
        <div class="header">
            <h1>Career Documents Generator</h1>
            <p>Create professional executive bios, status inquiry letters, and personal brand statements</p>
            <div style="margin-top: 1rem;">
                <button onclick="exportCompletePackage()" class="btn-primary" style="padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none;">
                    ðŸ“¦ Export Complete Package
                </button>
                <span id="package-status" style="margin-left: 1rem; font-size: 0.9rem; color: var(--text-muted);"></span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('bio')">Executive Bio</button>
            <button class="tab-btn" onclick="switchTab('inquiry')">Status Inquiry</button>
            <button class="tab-btn" onclick="switchTab('brand')">Brand Statement</button>
        </div>

        <!-- Job Import Section -->
        <div class="job-import-section" id="job-import-section">
            <h3>
                <span>Import Job Posting <span class="tooltip-trigger" data-tooltip="job-import" style="background: rgba(255,255,255,0.3);">?</span></span>
                <span id="job-data-indicator"></span>
            </h3>
            <p>Paste a job URL to auto-fill relevant fields and tailor your documents to the position.</p>
            <p id="api-key-status" style="font-size: 0.85em; padding: 8px 12px; border-radius: 6px; margin-bottom: 10px; display: inline-block;"></p>

            <div class="job-url-input-group">
                <input type="url" id="job-url-input" placeholder="https://linkedin.com/jobs/view/..." />
                <button id="fetch-job-btn" onclick="fetchJobPosting()">Import Job</button>
            </div>

            <div class="supported-sites">
                <span>LinkedIn</span>
                <span>Indeed</span>
                <span>Glassdoor</span>
                <span>Greenhouse</span>
                <span>Lever</span>
                <span>+7 more</span>
            </div>

            <button class="paste-text-toggle" onclick="togglePasteArea()">Or paste job description text directly</button>

            <div class="paste-text-area" id="paste-text-area">
                <textarea id="job-text-input" placeholder="Paste the full job description here..."></textarea>
                <div style="margin-top: 10px;">
                    <button class="job-url-input-group button" style="padding: 10px 20px; background: white; color: var(--primary); border: none; border-radius: 6px; font-weight: 600; cursor: pointer;" onclick="parseJobText()">Parse Job Description</button>
                </div>
            </div>

            <div class="job-preview" id="job-preview">
                <h4>Imported Job Details</h4>
                <div class="job-preview-content" id="job-preview-content"></div>
                <div class="job-preview-actions">
                    <button class="btn-use" onclick="useJobData()">Use This Job Data</button>
                    <button class="btn-clear" onclick="clearJobData()">Clear</button>
                </div>
            </div>
        </div>

        <!-- LinkedIn Job Search Section -->
        <div id="linkedin-search-container"></div>

        <!-- Executive Bio Tab -->
        <div id="tab-bio" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h2>Executive Bio Generator</h2>
                    <p>Create professional biographies for executives, speakers, and professionals</p>
                </div>
                <div class="card-body">
                    <div class="api-key-section">
                        <h3>API Configuration</h3>
                        <div class="inline-form">
                            <input type="password" id="bio-api-key" placeholder="Enter Claude API Key">
                            <button class="btn btn-secondary" onclick="saveApiKey('bio')">Save Key</button>
                        </div>
                    </div>

                    <div id="bio-status" class="status-message"></div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Full Name * <span class="tooltip-trigger" data-tooltip="bio-name">?</span></label>
                            <input type="text" id="bio-name" placeholder="John Smith">
                        </div>
                        <div class="form-group">
                            <label>Current Title * <span class="tooltip-trigger" data-tooltip="bio-title">?</span></label>
                            <input type="text" id="bio-title" placeholder="Chief Technology Officer">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" id="bio-company" placeholder="Acme Corporation">
                        </div>
                        <div class="form-group">
                            <label>Years of Experience</label>
                            <input type="number" id="bio-years" placeholder="15" min="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Education</label>
                        <input type="text" id="bio-education" placeholder="MBA from Harvard Business School">
                    </div>

                    <div class="form-group">
                        <label>Key Achievements (press Enter to add) <span class="tooltip-trigger" data-tooltip="bio-achievements">?</span></label>
                        <div class="tags-input" id="bio-achievements-container">
                            <input type="text" class="add-tag-input" id="bio-achievement-input"
                                   placeholder="Type achievement and press Enter">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Areas of Expertise (press Enter to add)</label>
                        <div class="tags-input" id="bio-expertise-container">
                            <input type="text" class="add-tag-input" id="bio-expertise-input"
                                   placeholder="Type expertise area and press Enter">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Bio Style <span class="tooltip-trigger" data-tooltip="bio-style">?</span></label>
                        <div class="option-cards">
                            <div class="option-card selected" data-value="executive" onclick="selectOption(this, 'bio-style')">
                                <h4>Executive</h4>
                                <p>C-suite, board-ready</p>
                            </div>
                            <div class="option-card" data-value="professional" onclick="selectOption(this, 'bio-style')">
                                <h4>Professional</h4>
                                <p>Corporate, balanced</p>
                            </div>
                            <div class="option-card" data-value="speaker" onclick="selectOption(this, 'bio-style')">
                                <h4>Speaker</h4>
                                <p>Conference, keynote</p>
                            </div>
                            <div class="option-card" data-value="academic" onclick="selectOption(this, 'bio-style')">
                                <h4>Academic</h4>
                                <p>Research-focused</p>
                            </div>
                        </div>
                        <input type="hidden" id="bio-style" value="executive">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Bio Length</label>
                            <select id="bio-length">
                                <option value="50">Short (50 words)</option>
                                <option value="100" selected>Medium (100 words)</option>
                                <option value="150">Full (150 words)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Perspective</label>
                            <select id="bio-perspective">
                                <option value="third" selected>Third Person (he/she)</option>
                                <option value="first">First Person (I)</option>
                            </select>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateBio()">Generate Bio</button>
                        <button class="btn btn-secondary" onclick="clearForm('bio')">Clear Form</button>
                    </div>

                    <div id="bio-output" class="output-section">
                        <div class="output-header">
                            <h3>Generated Bio</h3>
                            <button class="btn btn-secondary" onclick="copyToClipboard('bio')">Copy to Clipboard</button>
                        </div>
                        <div class="output-content" id="bio-content"></div>
                        <div class="word-count" id="bio-wordcount"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Inquiry Tab -->
        <div id="tab-inquiry" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>Status Inquiry Letter Generator</h2>
                    <p>Create professional follow-up letters for job applications</p>
                </div>
                <div class="card-body">
                    <div class="api-key-section">
                        <h3>API Configuration</h3>
                        <div class="inline-form">
                            <input type="password" id="inquiry-api-key" placeholder="Enter Claude API Key">
                            <button class="btn btn-secondary" onclick="saveApiKey('inquiry')">Save Key</button>
                        </div>
                    </div>

                    <div id="inquiry-status" class="status-message"></div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Job Title *</label>
                            <input type="text" id="inquiry-job-title" placeholder="Senior Software Engineer">
                        </div>
                        <div class="form-group">
                            <label>Company Name *</label>
                            <input type="text" id="inquiry-company" placeholder="Tech Company Inc.">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Application Date</label>
                            <input type="date" id="inquiry-app-date">
                        </div>
                        <div class="form-group">
                            <label>Interview Date (if applicable)</label>
                            <input type="date" id="inquiry-interview-date">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Contact Name (optional)</label>
                        <input type="text" id="inquiry-contact" placeholder="Jane Doe">
                    </div>

                    <div class="form-group">
                        <label>Inquiry Type <span class="tooltip-trigger" data-tooltip="inquiry-type">?</span></label>
                        <div class="option-cards">
                            <div class="option-card selected" data-value="post-application" onclick="selectOption(this, 'inquiry-type')">
                                <h4>Post-Application</h4>
                                <p>After submitting</p>
                            </div>
                            <div class="option-card" data-value="post-interview" onclick="selectOption(this, 'inquiry-type')">
                                <h4>Post-Interview</h4>
                                <p>After interviewing</p>
                            </div>
                            <div class="option-card" data-value="offer-timeline" onclick="selectOption(this, 'inquiry-type')">
                                <h4>Offer Timeline</h4>
                                <p>Awaiting offer</p>
                            </div>
                            <div class="option-card" data-value="decision-update" onclick="selectOption(this, 'inquiry-type')">
                                <h4>Decision Update</h4>
                                <p>Final decision</p>
                            </div>
                        </div>
                        <input type="hidden" id="inquiry-type" value="post-application">
                    </div>

                    <div class="form-group">
                        <label>Tone <span class="tooltip-trigger" data-tooltip="inquiry-tone">?</span></label>
                        <div class="option-cards">
                            <div class="option-card selected" data-value="professional" onclick="selectOption(this, 'inquiry-tone')">
                                <h4>Professional</h4>
                                <p>Formal, businesslike</p>
                            </div>
                            <div class="option-card" data-value="warm" onclick="selectOption(this, 'inquiry-tone')">
                                <h4>Warm</h4>
                                <p>Friendly, personable</p>
                            </div>
                            <div class="option-card" data-value="direct" onclick="selectOption(this, 'inquiry-tone')">
                                <h4>Direct</h4>
                                <p>Concise, to-the-point</p>
                            </div>
                        </div>
                        <input type="hidden" id="inquiry-tone" value="professional">
                    </div>

                    <div class="form-group">
                        <label>Additional Context (optional)</label>
                        <textarea id="inquiry-context" placeholder="Any additional details to include..."></textarea>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateInquiry()">Generate Letter</button>
                        <button class="btn btn-secondary" onclick="clearForm('inquiry')">Clear Form</button>
                    </div>

                    <div id="inquiry-output" class="output-section">
                        <div class="output-header">
                            <h3>Generated Letter</h3>
                            <button class="btn btn-secondary" onclick="copyToClipboard('inquiry')">Copy to Clipboard</button>
                        </div>
                        <div class="output-content" id="inquiry-content"></div>
                        <div class="word-count" id="inquiry-wordcount"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Brand Statement Tab -->
        <div id="tab-brand" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>Personal Brand Statement Generator</h2>
                    <p>Create compelling personal brand statements for any audience</p>
                </div>
                <div class="card-body">
                    <div class="api-key-section">
                        <h3>API Configuration</h3>
                        <div class="inline-form">
                            <input type="password" id="brand-api-key" placeholder="Enter Claude API Key">
                            <button class="btn btn-secondary" onclick="saveApiKey('brand')">Save Key</button>
                        </div>
                    </div>

                    <div id="brand-status" class="status-message"></div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="brand-name" placeholder="John Smith">
                        </div>
                        <div class="form-group">
                            <label>Current Role *</label>
                            <input type="text" id="brand-role" placeholder="Product Manager">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Target Role (if different from current)</label>
                        <input type="text" id="brand-target" placeholder="VP of Product">
                    </div>

                    <div class="form-group">
                        <label>Core Values (press Enter to add) <span class="tooltip-trigger" data-tooltip="brand-values">?</span></label>
                        <div class="tags-input" id="brand-values-container">
                            <input type="text" class="add-tag-input" id="brand-values-input"
                                   placeholder="e.g., Innovation, Integrity">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Key Expertise (press Enter to add)</label>
                        <div class="tags-input" id="brand-expertise-container">
                            <input type="text" class="add-tag-input" id="brand-expertise-input"
                                   placeholder="e.g., Data Analytics, Team Leadership">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Unique Differentiators (press Enter to add) <span class="tooltip-trigger" data-tooltip="brand-differentiators">?</span></label>
                        <div class="tags-input" id="brand-diff-container">
                            <input type="text" class="add-tag-input" id="brand-diff-input"
                                   placeholder="What makes you unique?">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Target Audience <span class="tooltip-trigger" data-tooltip="brand-audience">?</span></label>
                        <div class="option-cards">
                            <div class="option-card selected" data-value="recruiters" onclick="selectOption(this, 'brand-audience')">
                                <h4>Recruiters</h4>
                                <p>Job search focused</p>
                            </div>
                            <div class="option-card" data-value="networking" onclick="selectOption(this, 'brand-audience')">
                                <h4>Networking</h4>
                                <p>Events & intros</p>
                            </div>
                            <div class="option-card" data-value="linkedin" onclick="selectOption(this, 'brand-audience')">
                                <h4>LinkedIn</h4>
                                <p>Profile headline</p>
                            </div>
                            <div class="option-card" data-value="website" onclick="selectOption(this, 'brand-audience')">
                                <h4>Website</h4>
                                <p>Portfolio bio</p>
                            </div>
                        </div>
                        <input type="hidden" id="brand-audience" value="recruiters">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Style</label>
                            <select id="brand-style">
                                <option value="professional" selected>Professional</option>
                                <option value="inspirational">Inspirational</option>
                                <option value="authentic">Authentic</option>
                                <option value="bold">Bold</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Length</label>
                            <select id="brand-length">
                                <option value="tagline">Tagline (10-15 words)</option>
                                <option value="elevator" selected>Elevator (40-60 words)</option>
                                <option value="full">Full (80-120 words)</option>
                            </select>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateBrand()">Generate Statement</button>
                        <button class="btn btn-primary" onclick="generateAllBrands()" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">Generate All Lengths</button>
                        <button class="btn btn-secondary" onclick="clearForm('brand')">Clear Form</button>
                    </div>

                    <div id="brand-output" class="output-section">
                        <div class="output-header">
                            <h3>Generated Statement</h3>
                            <button class="btn btn-secondary" onclick="copyToClipboard('brand')">Copy to Clipboard</button>
                        </div>
                        <div class="output-content" id="brand-content"></div>
                        <div class="word-count" id="brand-wordcount"></div>
                    </div>

                    <div id="brand-all-output" class="output-section">
                        <h3 style="color: var(--primary); margin-bottom: 20px;">All Versions</h3>

                        <div style="margin-bottom: 20px;">
                            <div class="output-header">
                                <h4 style="margin: 0;">Tagline</h4>
                                <button class="btn btn-secondary" onclick="copyText('brand-tagline')">Copy</button>
                            </div>
                            <div class="output-content" id="brand-tagline"></div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <div class="output-header">
                                <h4 style="margin: 0;">Elevator Pitch</h4>
                                <button class="btn btn-secondary" onclick="copyText('brand-elevator')">Copy</button>
                            </div>
                            <div class="output-content" id="brand-elevator"></div>
                        </div>

                        <div>
                            <div class="output-header">
                                <h4 style="margin: 0;">Full Narrative</h4>
                                <button class="btn btn-secondary" onclick="copyText('brand-full')">Copy</button>
                            </div>
                            <div class="output-content" id="brand-full"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Core Data Management -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="js/core/data-bridge.js"></script>
    <script src="js/core/package-manager.js"></script>

    <!-- Load Career Documents Scripts -->
    <script src="js/utils/tooltips.js"></script>
    <script src="js/utils/onboarding.js"></script>
    <script src="js/utils/job-url-parser.js"></script>
    <script src="js/utils/linkedin-search.js"></script>
    <script src="js/careerdocs/prompts.js"></script>
    <script src="js/careerdocs/bio-generator.js"></script>
    <script src="js/careerdocs/inquiry-generator.js"></script>
    <script src="js/careerdocs/brand-generator.js"></script>

    <script>
        // Global job data store
        let currentJobData = null;

        // Store for tags
        const tagStore = {
            'bio-achievements': [],
            'bio-expertise': [],
            'brand-values': [],
            'brand-expertise': [],
            'brand-diff': []
        };

        // Track if server has API key configured
        let serverHasApiKey = false;

        // Update API key status indicator (checks server first)
        async function updateApiKeyStatus() {
            const statusEl = document.getElementById('api-key-status');
            const localApiKey = localStorage.getItem('claude_api_key');

            // Check server config
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                serverHasApiKey = config.hasServerApiKey;
            } catch (e) {
                serverHasApiKey = false;
            }

            if (serverHasApiKey || localApiKey) {
                statusEl.innerHTML = serverHasApiKey
                    ? 'âœ“ Server API Key configured - Ready to import jobs'
                    : 'âœ“ API Key configured - Ready to import jobs';
                statusEl.style.background = 'rgba(39, 174, 96, 0.3)';
                statusEl.style.border = '1px solid rgba(39, 174, 96, 0.5)';
            } else {
                statusEl.innerHTML = 'âš ï¸ API Key required - Set your key in any tab below first';
                statusEl.style.background = 'rgba(243, 156, 18, 0.3)';
                statusEl.style.border = '1px solid rgba(243, 156, 18, 0.5)';
            }
        }

        // Check if API key is available (server or local)
        function hasApiKey() {
            return serverHasApiKey || localStorage.getItem('claude_api_key');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            // Load data from DataBridge if available
            if (window.dataBridge) {
                const userData = window.dataBridge.getUserData();

                // Load API key from preferences
                const apiKey = userData.preferences?.apiKey || localStorage.getItem('claude_api_key');
                if (apiKey) {
                    document.getElementById('bio-api-key').value = apiKey;
                    document.getElementById('inquiry-api-key').value = apiKey;
                    document.getElementById('brand-api-key').value = apiKey;
                }

                // Load user info
                if (userData.user) {
                    const bioNameInput = document.getElementById('bio-name');
                    const bioTitleInput = document.getElementById('bio-title');

                    if (bioNameInput && userData.user.name) {
                        bioNameInput.value = userData.user.name;
                    }
                    // Can add more auto-fill logic here
                }

                // Load job data
                if (userData.job?.title && userData.job?.company) {
                    const inquiryJobInput = document.getElementById('inquiry-job-title');
                    const inquiryCompanyInput = document.getElementById('inquiry-company-name');

                    if (inquiryJobInput) inquiryJobInput.value = userData.job.title;
                    if (inquiryCompanyInput) inquiryCompanyInput.value = userData.job.company;
                }

                console.log('[Career Docs] Loaded user data from DataBridge');
            } else {
                // Fallback to legacy localStorage
                const savedKey = localStorage.getItem('claude_api_key');
                if (savedKey) {
                    document.getElementById('bio-api-key').value = savedKey;
                    document.getElementById('inquiry-api-key').value = savedKey;
                    document.getElementById('brand-api-key').value = savedKey;
                }
            }

            // Setup tag inputs
            setupTagInput('bio-achievement-input', 'bio-achievements-container', 'bio-achievements');
            setupTagInput('bio-expertise-input', 'bio-expertise-container', 'bio-expertise');
            setupTagInput('brand-values-input', 'brand-values-container', 'brand-values');
            setupTagInput('brand-expertise-input', 'brand-expertise-container', 'brand-expertise');
            setupTagInput('brand-diff-input', 'brand-diff-container', 'brand-diff');

            // Initialize LinkedIn Job Search
            if (typeof linkedInJobSearch !== 'undefined') {
                linkedInJobSearch.initialize('linkedin-search-container');
            }

            // Update API key status indicator
            updateApiKeyStatus();

            // Update package status
            updatePackageStatus();
        });

        // Export complete package
        async function exportCompletePackage() {
            if (!window.packageManager) {
                alert('Package manager not initialized. Please refresh the page.');
                return;
            }

            const status = window.packageManager.getPackageStatus();

            if (!status.readyForExport) {
                alert('No documents generated yet. Please generate at least one document before exporting.');
                return;
            }

            const statusButton = document.querySelector('button[onclick="exportCompletePackage()"]');
            statusButton.disabled = true;
            statusButton.textContent = 'ðŸ“¦ Exporting...';

            try {
                const success = await window.packageManager.exportPackage('job-application-package');

                if (success) {
                    alert(`Package exported successfully!\n\nIncluded ${status.completionPercentage}% of documents.\n\nCheck your downloads folder.`);
                    statusButton.textContent = 'ðŸ“¦ Export Complete Package';
                } else {
                    alert('Export failed. Please try again.');
                    statusButton.textContent = 'ðŸ“¦ Export Complete Package';
                }
            } catch (error) {
                console.error('[Career Docs] Export error:', error);
                alert('Export failed: ' + error.message);
                statusButton.textContent = 'ðŸ“¦ Export Complete Package';
            } finally {
                statusButton.disabled = false;
            }
        }

        // Update package status indicator
        function updatePackageStatus() {
            if (!window.packageManager) {
                return;
            }

            const status = window.packageManager.getPackageStatus();
            const statusEl = document.getElementById('package-status');

            if (statusEl) {
                const documentsReady = [
                    status.resume ? 'Resume' : null,
                    status.coverLetter ? 'Cover Letter' : null,
                    status.executiveBio ? 'Executive Bio' : null,
                    status.brandStatement ? 'Brand Statement' : null,
                    status.statusInquiry ? 'Status Inquiry' : null
                ].filter(Boolean);

                if (documentsReady.length > 0) {
                    statusEl.textContent = `${status.completionPercentage}% complete (${documentsReady.join(', ')})`;
                    statusEl.style.color = 'var(--success)';
                } else {
                    statusEl.textContent = 'No documents yet';
                    statusEl.style.color = 'var(--text-muted)';
                }
            }
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // Option card selection
        function selectOption(element, inputId) {
            const parent = element.parentElement;
            parent.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');
            document.getElementById(inputId).value = element.dataset.value;
        }

        // Save API key
        function saveApiKey(section) {
            const key = document.getElementById(`${section}-api-key`).value;
            if (key) {
                localStorage.setItem('claude_api_key', key);
                // Sync to other fields
                document.getElementById('bio-api-key').value = key;
                document.getElementById('inquiry-api-key').value = key;
                document.getElementById('brand-api-key').value = key;
                showStatus(section, 'API key saved successfully!', 'success');
                // Update the job import status indicator
                updateApiKeyStatus();
            }
        }

        // Tag input setup
        function setupTagInput(inputId, containerId, storeKey) {
            const input = document.getElementById(inputId);
            const container = document.getElementById(containerId);

            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && input.value.trim()) {
                    e.preventDefault();
                    addTag(storeKey, input.value.trim(), containerId, inputId);
                    input.value = '';
                }
            });
        }

        function addTag(storeKey, value, containerId, inputId) {
            if (tagStore[storeKey].includes(value)) return;

            tagStore[storeKey].push(value);
            const container = document.getElementById(containerId);
            const input = document.getElementById(inputId);

            const tag = document.createElement('span');
            tag.className = 'tag';
            tag.innerHTML = `${value} <button onclick="removeTag('${storeKey}', '${value}', this)">&times;</button>`;
            container.insertBefore(tag, input);
        }

        function removeTag(storeKey, value, button) {
            const index = tagStore[storeKey].indexOf(value);
            if (index > -1) {
                tagStore[storeKey].splice(index, 1);
            }
            button.parentElement.remove();
        }

        // Show status message
        function showStatus(section, message, type) {
            const statusEl = document.getElementById(`${section}-status`);
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;

            if (type === 'success') {
                setTimeout(() => {
                    statusEl.className = 'status-message';
                }, 3000);
            }
        }

        // Generate Executive Bio
        async function generateBio() {
            const name = document.getElementById('bio-name').value;
            const currentTitle = document.getElementById('bio-title').value;

            if (!name || !currentTitle) {
                showStatus('bio', 'Please fill in name and current title', 'error');
                return;
            }

            showStatus('bio', 'Generating bio...', 'success');

            try {
                const result = await executiveBioGenerator.generate({
                    name,
                    currentTitle,
                    company: document.getElementById('bio-company').value,
                    yearsExperience: parseInt(document.getElementById('bio-years').value) || 0,
                    education: document.getElementById('bio-education').value,
                    achievements: tagStore['bio-achievements'],
                    expertise: tagStore['bio-expertise'],
                    style: document.getElementById('bio-style').value,
                    length: parseInt(document.getElementById('bio-length').value),
                    perspective: document.getElementById('bio-perspective').value
                });

                if (result.success) {
                    document.getElementById('bio-content').textContent = result.content;
                    document.getElementById('bio-wordcount').textContent = `Word count: ${result.metadata.wordCount}`;
                    document.getElementById('bio-output').classList.add('visible');

                    // Save to PackageManager
                    if (window.packageManager) {
                        window.packageManager.addDocument('executiveBio', {
                            content: result.content,
                            format: 'text',
                            metadata: result.metadata
                        });
                        console.log('[Career Docs] Saved executive bio to PackageManager');
                        updatePackageStatus();
                    }

                    showStatus('bio', 'Bio generated successfully!', 'success');
                } else {
                    showStatus('bio', result.error || 'Generation failed', 'error');
                }
            } catch (error) {
                showStatus('bio', error.message, 'error');
            }
        }

        // Generate Status Inquiry
        async function generateInquiry() {
            const jobTitle = document.getElementById('inquiry-job-title').value;
            const companyName = document.getElementById('inquiry-company').value;

            if (!jobTitle || !companyName) {
                showStatus('inquiry', 'Please fill in job title and company name', 'error');
                return;
            }

            showStatus('inquiry', 'Generating letter...', 'success');

            try {
                const result = await statusInquiryGenerator.generate({
                    jobTitle,
                    companyName,
                    applicationDate: document.getElementById('inquiry-app-date').value,
                    interviewDate: document.getElementById('inquiry-interview-date').value,
                    contactName: document.getElementById('inquiry-contact').value,
                    inquiryType: document.getElementById('inquiry-type').value,
                    tone: document.getElementById('inquiry-tone').value,
                    additionalContext: document.getElementById('inquiry-context').value
                });

                if (result.success) {
                    document.getElementById('inquiry-content').textContent = result.content;
                    document.getElementById('inquiry-wordcount').textContent = `Word count: ${result.metadata.wordCount}`;
                    document.getElementById('inquiry-output').classList.add('visible');

                    // Save to PackageManager
                    if (window.packageManager) {
                        window.packageManager.addDocument('statusInquiry', {
                            content: result.content,
                            format: 'text',
                            metadata: result.metadata
                        });
                        console.log('[Career Docs] Saved status inquiry to PackageManager');
                        updatePackageStatus();
                    }

                    showStatus('inquiry', 'Letter generated successfully!', 'success');
                } else {
                    showStatus('inquiry', result.error || 'Generation failed', 'error');
                }
            } catch (error) {
                showStatus('inquiry', error.message, 'error');
            }
        }

        // Generate Brand Statement
        async function generateBrand() {
            const name = document.getElementById('brand-name').value;
            const currentRole = document.getElementById('brand-role').value;

            if (!name || !currentRole) {
                showStatus('brand', 'Please fill in name and current role', 'error');
                return;
            }

            showStatus('brand', 'Generating statement...', 'success');

            try {
                const result = await brandStatementGenerator.generate({
                    name,
                    currentRole,
                    targetRole: document.getElementById('brand-target').value,
                    coreValues: tagStore['brand-values'],
                    expertise: tagStore['brand-expertise'],
                    differentiators: tagStore['brand-diff'],
                    audience: document.getElementById('brand-audience').value,
                    style: document.getElementById('brand-style').value,
                    length: document.getElementById('brand-length').value
                });

                if (result.success) {
                    document.getElementById('brand-content').textContent = result.content;
                    document.getElementById('brand-wordcount').textContent = `Word count: ${result.metadata.wordCount}`;
                    document.getElementById('brand-output').classList.add('visible');
                    document.getElementById('brand-all-output').classList.remove('visible');

                    // Save to PackageManager
                    if (window.packageManager) {
                        window.packageManager.addDocument('brandStatement', {
                            content: result.content,
                            format: 'text',
                            metadata: result.metadata
                        });
                        console.log('[Career Docs] Saved brand statement to PackageManager');
                        updatePackageStatus();
                    }

                    showStatus('brand', 'Statement generated successfully!', 'success');
                } else {
                    showStatus('brand', result.error || 'Generation failed', 'error');
                }
            } catch (error) {
                showStatus('brand', error.message, 'error');
            }
        }

        // Generate all brand statement lengths
        async function generateAllBrands() {
            const name = document.getElementById('brand-name').value;
            const currentRole = document.getElementById('brand-role').value;

            if (!name || !currentRole) {
                showStatus('brand', 'Please fill in name and current role', 'error');
                return;
            }

            showStatus('brand', 'Generating all versions...', 'success');

            try {
                const params = {
                    name,
                    currentRole,
                    targetRole: document.getElementById('brand-target').value,
                    coreValues: tagStore['brand-values'],
                    expertise: tagStore['brand-expertise'],
                    differentiators: tagStore['brand-diff'],
                    audience: document.getElementById('brand-audience').value,
                    style: document.getElementById('brand-style').value
                };

                const result = await brandStatementGenerator.generateAllLengths(params);

                if (result.success) {
                    if (result.tagline.success) {
                        document.getElementById('brand-tagline').textContent = result.tagline.content;
                    }
                    if (result.elevator.success) {
                        document.getElementById('brand-elevator').textContent = result.elevator.content;
                    }
                    if (result.full.success) {
                        document.getElementById('brand-full').textContent = result.full.content;
                    }

                    document.getElementById('brand-output').classList.remove('visible');
                    document.getElementById('brand-all-output').classList.add('visible');
                    showStatus('brand', 'All versions generated successfully!', 'success');
                } else {
                    showStatus('brand', 'Generation failed', 'error');
                }
            } catch (error) {
                showStatus('brand', error.message, 'error');
            }
        }

        // Copy to clipboard
        async function copyToClipboard(section) {
            const content = document.getElementById(`${section}-content`).textContent;
            try {
                await navigator.clipboard.writeText(content);
                showStatus(section, 'Copied to clipboard!', 'success');
            } catch (error) {
                showStatus(section, 'Copy failed', 'error');
            }
        }

        async function copyText(elementId) {
            const content = document.getElementById(elementId).textContent;
            try {
                await navigator.clipboard.writeText(content);
                alert('Copied to clipboard!');
            } catch (error) {
                alert('Copy failed');
            }
        }

        // Clear form
        function clearForm(section) {
            if (section === 'bio') {
                document.getElementById('bio-name').value = '';
                document.getElementById('bio-title').value = '';
                document.getElementById('bio-company').value = '';
                document.getElementById('bio-years').value = '';
                document.getElementById('bio-education').value = '';
                tagStore['bio-achievements'] = [];
                tagStore['bio-expertise'] = [];
                document.getElementById('bio-achievements-container').querySelectorAll('.tag').forEach(t => t.remove());
                document.getElementById('bio-expertise-container').querySelectorAll('.tag').forEach(t => t.remove());
                document.getElementById('bio-output').classList.remove('visible');
            } else if (section === 'inquiry') {
                document.getElementById('inquiry-job-title').value = '';
                document.getElementById('inquiry-company').value = '';
                document.getElementById('inquiry-app-date').value = '';
                document.getElementById('inquiry-interview-date').value = '';
                document.getElementById('inquiry-contact').value = '';
                document.getElementById('inquiry-context').value = '';
                document.getElementById('inquiry-output').classList.remove('visible');
            } else if (section === 'brand') {
                document.getElementById('brand-name').value = '';
                document.getElementById('brand-role').value = '';
                document.getElementById('brand-target').value = '';
                tagStore['brand-values'] = [];
                tagStore['brand-expertise'] = [];
                tagStore['brand-diff'] = [];
                document.getElementById('brand-values-container').querySelectorAll('.tag').forEach(t => t.remove());
                document.getElementById('brand-expertise-container').querySelectorAll('.tag').forEach(t => t.remove());
                document.getElementById('brand-diff-container').querySelectorAll('.tag').forEach(t => t.remove());
                document.getElementById('brand-output').classList.remove('visible');
                document.getElementById('brand-all-output').classList.remove('visible');
            }
            document.getElementById(`${section}-status`).className = 'status-message';
        }

        // =====================================================
        // Job Import Functions
        // =====================================================

        // Fetch and parse job posting from URL
        async function fetchJobPosting() {
            const urlInput = document.getElementById('job-url-input');
            const fetchBtn = document.getElementById('fetch-job-btn');
            const url = urlInput.value.trim();

            if (!url) {
                alert('Please enter a job URL');
                return;
            }

            // Check for API key FIRST - required for AI parsing (server or local)
            if (!hasApiKey()) {
                alert('Please set your Claude API key first!\n\nScroll down to any tab (Executive Bio, Status Inquiry, or Brand Statement) and enter your API key in the "API Configuration" section, then click "Save Key".');
                return;
            }

            // Validate URL format
            try {
                new URL(url);
            } catch (e) {
                alert('Please enter a valid URL');
                return;
            }

            // Check if site is supported
            if (typeof jobURLParser !== 'undefined' && !jobURLParser.isSupported(url)) {
                const supportedSites = jobURLParser.getSupportedSites().join(', ');
                alert(`This job site is not supported yet. Supported sites: ${supportedSites}\n\nYou can paste the job description text directly instead.`);
                return;
            }

            // Show loading state
            fetchBtn.disabled = true;
            fetchBtn.textContent = 'Importing...';

            try {
                const result = await jobURLParser.fetchAndParse(url);

                if (result.success) {
                    currentJobData = result;
                    displayJobPreview(result);
                } else {
                    alert(`Failed to import job: ${result.error}\n\nTry pasting the job description text directly.`);
                    togglePasteArea();
                }
            } catch (error) {
                console.error('Job fetch error:', error);
                alert(`Error importing job: ${error.message}\n\nTry pasting the job description text directly.`);
                togglePasteArea();
            } finally {
                fetchBtn.disabled = false;
                fetchBtn.textContent = 'Import Job';
            }
        }

        // Parse job description text directly
        async function parseJobText() {
            const textInput = document.getElementById('job-text-input');
            const text = textInput.value.trim();

            if (!text) {
                alert('Please paste a job description');
                return;
            }

            // Check for API key FIRST - required for AI parsing (server or local)
            if (!hasApiKey()) {
                alert('Please set your Claude API key first!\n\nScroll down to any tab (Executive Bio, Status Inquiry, or Brand Statement) and enter your API key in the "API Configuration" section, then click "Save Key".');
                return;
            }

            if (text.length < 50) {
                alert('Job description is too short. Please provide more details.');
                return;
            }

            try {
                const result = await jobURLParser.parseText(text);

                if (result.success) {
                    currentJobData = result;
                    displayJobPreview(result);
                } else {
                    alert(`Failed to parse job description: ${result.error}`);
                }
            } catch (error) {
                console.error('Job parse error:', error);
                alert(`Error parsing job description: ${error.message}`);
            }
        }

        // Toggle paste text area visibility
        function togglePasteArea() {
            const pasteArea = document.getElementById('paste-text-area');
            pasteArea.classList.toggle('visible');
        }

        // Display job preview
        function displayJobPreview(jobData) {
            const preview = document.getElementById('job-preview');
            const content = document.getElementById('job-preview-content');

            if (!jobData || !jobData.parsed) {
                preview.classList.remove('visible');
                return;
            }

            const p = jobData.parsed;
            let html = '';

            if (p.jobTitle) html += `<strong>Position:</strong> ${p.jobTitle}<br>`;
            if (p.company) html += `<strong>Company:</strong> ${p.company}<br>`;
            if (p.location) html += `<strong>Location:</strong> ${p.location}`;
            if (p.workType) html += ` (${p.workType})`;
            html += '<br>';
            if (p.salaryRange) html += `<strong>Salary:</strong> ${p.salaryRange}<br>`;
            if (p.experienceLevel) html += `<strong>Level:</strong> ${p.experienceLevel}<br>`;

            if (p.summary) {
                html += `<br><strong>Summary:</strong><br>${p.summary}<br>`;
            }

            if (p.requiredSkills && p.requiredSkills.length > 0) {
                html += `<br><strong>Required Skills:</strong> ${p.requiredSkills.slice(0, 5).join(', ')}`;
                if (p.requiredSkills.length > 5) html += ` +${p.requiredSkills.length - 5} more`;
                html += '<br>';
            }

            if (p.keywords && p.keywords.length > 0) {
                html += `<strong>Keywords:</strong> ${p.keywords.slice(0, 8).join(', ')}<br>`;
            }

            content.innerHTML = html;
            preview.classList.add('visible');

            // Update indicator
            updateJobDataIndicator(true, p.jobTitle, p.company);
        }

        // Update job data indicator badge
        function updateJobDataIndicator(hasData, jobTitle, company) {
            const indicator = document.getElementById('job-data-indicator');
            if (hasData) {
                indicator.innerHTML = `<span class="job-data-badge">âœ“ ${jobTitle || 'Job'} @ ${company || 'Company'}<button onclick="clearJobData()">&times;</button></span>`;
            } else {
                indicator.innerHTML = '';
            }
        }

        // Use job data - apply to form fields
        function useJobData() {
            if (!currentJobData || !currentJobData.parsed) {
                alert('No job data available');
                return;
            }

            const p = currentJobData.parsed;

            // Auto-fill Status Inquiry form (most relevant for job postings)
            if (p.jobTitle) {
                document.getElementById('inquiry-job-title').value = p.jobTitle;
            }
            if (p.company) {
                document.getElementById('inquiry-company').value = p.company;
            }

            // Auto-fill Brand Statement target role
            if (p.jobTitle) {
                document.getElementById('brand-target').value = p.jobTitle;
            }

            // Auto-fill Bio title if empty
            const bioTitle = document.getElementById('bio-title');
            if (!bioTitle.value && p.jobTitle) {
                bioTitle.value = p.jobTitle;
            }

            // Add skills to brand expertise if available
            if (p.requiredSkills && p.requiredSkills.length > 0) {
                const container = document.getElementById('brand-expertise-container');
                const input = document.getElementById('brand-expertise-input');

                p.requiredSkills.slice(0, 5).forEach(skill => {
                    if (!tagStore['brand-expertise'].includes(skill)) {
                        addTag('brand-expertise', skill, 'brand-expertise-container', 'brand-expertise-input');
                    }
                });
            }

            // Switch to Status Inquiry tab (most relevant for job applications)
            switchTabProgrammatic('inquiry');

            // Collapse the preview
            document.getElementById('job-preview').classList.remove('visible');

            // Show success message
            alert('Job data applied! Relevant fields have been auto-filled.');
        }

        // Programmatic tab switch (without event)
        function switchTabProgrammatic(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Find and activate the correct tab button
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(tabName.substring(0, 3))) {
                    btn.classList.add('active');
                }
            });

            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // Clear imported job data
        function clearJobData() {
            currentJobData = null;
            document.getElementById('job-url-input').value = '';
            document.getElementById('job-text-input').value = '';
            document.getElementById('job-preview').classList.remove('visible');
            document.getElementById('paste-text-area').classList.remove('visible');
            updateJobDataIndicator(false);
        }
    </script>
    <script src="js/navigation/loader.js"></script>
</body>
</html>
