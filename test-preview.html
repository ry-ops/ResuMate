<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResuMate Preview System Test</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/preview.css">
    <style>
        body { margin: 0; padding: 1rem; }
        .test-controls {
            background: white;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-controls button {
            margin: 0.5rem 0.5rem 0.5rem 0;
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .test-controls button:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body id="main-content" tabindex="-1">
    <div class="test-controls">
        <h2>Preview System Test</h2>
        <button onclick="loadSampleResume()">Load Sample Resume</button>
        <button onclick="loadMinimalResume()">Load Minimal Resume</button>
        <button onclick="loadComplexResume()">Load Complex Resume</button>
        <button onclick="clearResume()">Clear</button>
        <button onclick="testPerformance()">Test Performance</button>
    </div>

    <div class="preview-layout split-view">
        <div class="editor-panel">
            <div class="card">
                <h2>Test Controls</h2>
                <p>Use the buttons above to test different resume scenarios.</p>
                <p>The preview should update within 500ms of state changes.</p>
                <div id="metrics" style="margin-top: 1rem; padding: 1rem; background: #f5f5f5; border-radius: 6px; font-family: monospace; font-size: 0.875rem;">
                    <strong>Performance Metrics:</strong><br>
                    Last Update: <span id="last-update">-</span>ms<br>
                    Update Count: <span id="update-count">0</span><br>
                    Average Time: <span id="avg-time">-</span>ms
                </div>
            </div>
        </div>

        <div class="preview-resizer"></div>

        <div class="preview-panel">
            <div class="preview-toolbar">
                <div class="preview-controls">
                    <button id="toggle-split-view" class="preview-btn active">Split View</button>
                    <button id="toggle-overlay" class="preview-btn">Preview Only</button>
                    <button id="hide-preview" class="preview-btn">Editor Only</button>
                    <div style="width: 1px; height: 24px; background: var(--border-color); margin: 0 0.25rem;"></div>
                    <button id="toggle-print-preview" class="preview-btn">Print Preview</button>
                    <div style="width: 1px; height: 24px; background: var(--border-color); margin: 0 0.25rem;"></div>
                    <button id="page-size-a4" class="preview-btn active">A4</button>
                    <button id="page-size-letter" class="preview-btn">Letter</button>
                </div>
                <div class="preview-info">
                    <span id="page-count">0 pages</span>
                </div>
            </div>

            <div id="preview-container"></div>
        </div>
    </div>

    <script src="js/editor/renderer.js"></script>
    <script src="js/editor/preview.js"></script>
    <script>
        let previewController;
        let renderer;

        // Sample resume data
        const sampleResumes = {
            minimal: {
                sections: [
                    {
                        id: 'header-1',
                        type: 'header',
                        name: 'Header',
                        required: true,
                        content: {
                            name: 'John Doe',
                            title: 'Software Engineer',
                            email: 'john.doe@email.com',
                            phone: '(555) 123-4567',
                            location: 'San Francisco, CA'
                        }
                    },
                    {
                        id: 'summary-1',
                        type: 'summary',
                        name: 'Professional Summary',
                        content: {
                            text: 'Experienced software engineer with 5+ years of full-stack development expertise.'
                        }
                    }
                ]
            },
            sample: {
                sections: [
                    {
                        id: 'header-1',
                        type: 'header',
                        name: 'Header',
                        required: true,
                        content: {
                            name: 'Jane Smith',
                            title: 'Senior Product Manager',
                            email: 'jane.smith@email.com',
                            phone: '(555) 987-6543',
                            location: 'New York, NY',
                            linkedin: 'linkedin.com/in/janesmith',
                            website: 'janesmith.com'
                        }
                    },
                    {
                        id: 'summary-1',
                        type: 'summary',
                        name: 'Professional Summary',
                        content: {
                            text: 'Results-driven product manager with 8+ years of experience leading cross-functional teams to deliver innovative solutions. Proven track record of launching successful products that drive revenue growth and customer satisfaction.'
                        }
                    },
                    {
                        id: 'experience-1',
                        type: 'experience',
                        name: 'Work Experience',
                        content: {
                            items: [
                                {
                                    title: 'Senior Product Manager',
                                    company: 'Tech Corp',
                                    location: 'New York, NY',
                                    date: 'Jan 2020 - Present',
                                    bullets: [
                                        'Led product strategy for flagship SaaS platform serving 10,000+ enterprise customers',
                                        'Increased user engagement by 45% through data-driven feature prioritization',
                                        'Managed team of 5 product managers and coordinated with 20+ engineers',
                                        'Drove $5M in annual recurring revenue through new product launches'
                                    ]
                                },
                                {
                                    title: 'Product Manager',
                                    company: 'StartUp Inc',
                                    location: 'San Francisco, CA',
                                    date: 'Mar 2017 - Dec 2019',
                                    bullets: [
                                        'Launched MVP in 6 months that acquired 5,000 users in first quarter',
                                        'Conducted 100+ user interviews to inform product roadmap',
                                        'Collaborated with design and engineering to ship 50+ features'
                                    ]
                                }
                            ]
                        }
                    },
                    {
                        id: 'education-1',
                        type: 'education',
                        name: 'Education',
                        content: {
                            items: [
                                {
                                    degree: 'MBA',
                                    institution: 'Stanford Graduate School of Business',
                                    location: 'Stanford, CA',
                                    date: '2015 - 2017',
                                    gpa: '3.9/4.0'
                                },
                                {
                                    degree: 'BS in Computer Science',
                                    institution: 'MIT',
                                    location: 'Cambridge, MA',
                                    date: '2011 - 2015',
                                    honors: 'Summa Cum Laude'
                                }
                            ]
                        }
                    },
                    {
                        id: 'skills-1',
                        type: 'skills',
                        name: 'Skills',
                        content: {
                            items: ['Product Strategy', 'Agile/Scrum', 'A/B Testing', 'SQL', 'Data Analysis', 'User Research', 'Roadmap Planning', 'Stakeholder Management']
                        }
                    }
                ]
            },
            complex: {
                sections: [
                    {
                        id: 'header-1',
                        type: 'header',
                        name: 'Header',
                        required: true,
                        content: {
                            name: 'Dr. Sarah Johnson',
                            title: 'Research Scientist & Team Lead',
                            email: 'sarah.johnson@research.edu',
                            phone: '(555) 234-5678',
                            location: 'Boston, MA',
                            linkedin: 'linkedin.com/in/sarahjohnson',
                            website: 'sarahjohnson.research.edu'
                        }
                    },
                    {
                        id: 'summary-1',
                        type: 'summary',
                        name: 'Professional Summary',
                        content: {
                            text: 'Award-winning research scientist with 12+ years of experience in machine learning and artificial intelligence. Published author of 30+ peer-reviewed papers with 2,000+ citations. Passionate about translating cutting-edge research into practical applications.'
                        }
                    },
                    {
                        id: 'experience-1',
                        type: 'experience',
                        name: 'Professional Experience',
                        content: {
                            items: [
                                {
                                    title: 'Principal Research Scientist',
                                    company: 'AI Research Lab',
                                    location: 'Boston, MA',
                                    date: 'Jan 2020 - Present',
                                    bullets: [
                                        'Lead team of 8 researchers working on natural language processing',
                                        'Developed novel transformer architecture achieving state-of-the-art results on 5 benchmarks',
                                        'Secured $2M in research funding from NSF and industry partners',
                                        'Mentor 3 PhD students and 5 postdoctoral researchers'
                                    ]
                                },
                                {
                                    title: 'Senior Research Scientist',
                                    company: 'Tech Giants Inc',
                                    location: 'Seattle, WA',
                                    date: 'Jun 2015 - Dec 2019',
                                    bullets: [
                                        'Contributed to production ML systems serving 500M+ users',
                                        'Published 15 papers at top-tier conferences (NeurIPS, ICML, ACL)',
                                        'Filed 8 patents in machine learning and NLP'
                                    ]
                                }
                            ]
                        }
                    },
                    {
                        id: 'education-1',
                        type: 'education',
                        name: 'Education',
                        content: {
                            items: [
                                {
                                    degree: 'PhD in Computer Science',
                                    institution: 'Carnegie Mellon University',
                                    location: 'Pittsburgh, PA',
                                    date: '2010 - 2015',
                                    gpa: '4.0/4.0'
                                },
                                {
                                    degree: 'MS in Computer Science',
                                    institution: 'Stanford University',
                                    location: 'Stanford, CA',
                                    date: '2008 - 2010'
                                }
                            ]
                        }
                    },
                    {
                        id: 'publications-1',
                        type: 'publications',
                        name: 'Selected Publications',
                        content: {
                            items: [
                                {
                                    title: 'Attention Is All You Need v2: Improvements to Transformer Architecture',
                                    publisher: 'NeurIPS 2023',
                                    date: '2023'
                                },
                                {
                                    title: 'Large Language Models for Code Generation',
                                    publisher: 'ICML 2022',
                                    date: '2022'
                                },
                                {
                                    title: 'Neural Machine Translation with Attention Mechanisms',
                                    publisher: 'ACL 2020',
                                    date: '2020'
                                }
                            ]
                        }
                    },
                    {
                        id: 'awards-1',
                        type: 'awards',
                        name: 'Awards & Honors',
                        content: {
                            items: [
                                {
                                    name: 'Best Paper Award',
                                    issuer: 'NeurIPS 2023',
                                    date: '2023'
                                },
                                {
                                    name: 'NSF CAREER Award',
                                    issuer: 'National Science Foundation',
                                    date: '2021'
                                },
                                {
                                    name: 'Outstanding Dissertation Award',
                                    issuer: 'CMU Computer Science',
                                    date: '2015'
                                }
                            ]
                        }
                    },
                    {
                        id: 'skills-1',
                        type: 'skills',
                        name: 'Technical Skills',
                        content: {
                            items: ['Python', 'PyTorch', 'TensorFlow', 'Machine Learning', 'Deep Learning', 'NLP', 'Computer Vision', 'Research Design', 'Statistical Analysis', 'Paper Writing']
                        }
                    },
                    {
                        id: 'languages-1',
                        type: 'languages',
                        name: 'Languages',
                        content: {
                            items: [
                                { name: 'English', proficiency: 'Native' },
                                { name: 'Mandarin', proficiency: 'Fluent' },
                                { name: 'Spanish', proficiency: 'Intermediate' }
                            ]
                        }
                    }
                ]
            }
        };

        // Initialize preview system
        document.addEventListener('DOMContentLoaded', function() {
            renderer = new ResumeRenderer();
            previewController = new PreviewController(renderer);
            previewController.initialize('preview-container');
            console.log('[Test] Preview system initialized');

            // Load sample by default
            loadSampleResume();
        });

        // Test functions
        function loadMinimalResume() {
            updatePreview(sampleResumes.minimal);
        }

        function loadSampleResume() {
            updatePreview(sampleResumes.sample);
        }

        function loadComplexResume() {
            updatePreview(sampleResumes.complex);
        }

        function clearResume() {
            updatePreview({ sections: [] });
        }

        function updatePreview(resumeState) {
            if (previewController) {
                previewController.update(resumeState);
                updateMetrics();
            }
        }

        function updateMetrics() {
            if (previewController) {
                const metrics = previewController.getMetrics();
                document.getElementById('last-update').textContent = metrics.lastUpdateTime.toFixed(2);
                document.getElementById('update-count').textContent = metrics.updateCount;
                document.getElementById('avg-time').textContent = metrics.averageUpdateTime.toFixed(2);
            }
        }

        function testPerformance() {
            console.log('[Test] Starting performance test...');
            const iterations = 10;
            const times = [];

            for (let i = 0; i < iterations; i++) {
                const start = performance.now();
                previewController.render(sampleResumes.sample);
                const end = performance.now();
                times.push(end - start);
            }

            const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
            const maxTime = Math.max(...times);
            const minTime = Math.min(...times);

            console.log(`[Test] Performance Results (${iterations} iterations):`);
            console.log(`  Average: ${avgTime.toFixed(2)}ms`);
            console.log(`  Min: ${minTime.toFixed(2)}ms`);
            console.log(`  Max: ${maxTime.toFixed(2)}ms`);
            console.log(`  Target: <500ms ${avgTime < 500 ? '✓ PASS' : '✗ FAIL'}`);

            alert(`Performance Test Complete\n\nAvg: ${avgTime.toFixed(2)}ms\nMin: ${minTime.toFixed(2)}ms\nMax: ${maxTime.toFixed(2)}ms\n\nTarget <500ms: ${avgTime < 500 ? 'PASS' : 'FAIL'}`);
        }
    </script>
    <script src="js/navigation/loader.js"></script>
</body>
</html>
