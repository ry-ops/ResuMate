<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Tracker - ResuMate</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/tracker.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #e5e7eb;
            padding: 20px;
        }

        .sidebar h1 {
            font-size: 20px;
            color: #1f2937;
            margin-bottom: 24px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 10px 12px;
            margin-bottom: 4px;
            border-radius: 6px;
            cursor: pointer;
            color: #6b7280;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .nav-item:hover,
        .nav-item.active {
            background: #f3f4f6;
            color: #1f2937;
        }

        .main-content {
            flex: 1;
            overflow: auto;
        }

        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
        }

        .toolbar {
            background: white;
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .deadlines-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .deadlines-panel h3 {
            margin: 0 0 16px 0;
            font-size: 18px;
            color: #1f2937;
        }

        .deadline-item {
            padding: 12px;
            background: #f9fafb;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .deadline-item.overdue {
            background: #fee2e2;
            border-left: 3px solid #dc2626;
        }

        .deadline-info {
            flex: 1;
        }

        .deadline-company {
            font-weight: 600;
            color: #1f2937;
            font-size: 14px;
        }

        .deadline-date {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            padding: 20px;
            background: white;
            margin: 20px;
            border-radius: 8px;
        }

        .quick-stat {
            text-align: center;
            padding: 16px;
            background: #f9fafb;
            border-radius: 6px;
        }

        .quick-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }

        .quick-stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .app-detail-modal {
            padding: 0;
        }

        .detail-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .detail-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .detail-section {
            margin-bottom: 24px;
        }

        .detail-section h4 {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .detail-item {
            font-size: 14px;
        }

        .detail-label {
            color: #6b7280;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .detail-value {
            color: #1f2937;
            font-weight: 500;
        }

        .timeline-item {
            padding: 12px;
            background: #f9fafb;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid #3b82f6;
        }

        .timeline-date {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .timeline-event {
            font-size: 14px;
            color: #1f2937;
            font-weight: 500;
        }
    </style>
</head>
<body id="main-content" tabindex="-1">
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <h1><i class="fas fa-briefcase"></i> ResuMate</h1>
            <ul class="nav-menu">
                <li class="nav-item active" data-view="board">
                    <i class="fas fa-columns"></i>
                    Board View
                </li>
                <li class="nav-item" data-view="deadlines">
                    <i class="fas fa-bell"></i>
                    Deadlines
                </li>
                <li class="nav-item" data-view="analytics">
                    <i class="fas fa-chart-bar"></i>
                    Analytics
                </li>
            </ul>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Board View -->
            <div id="view-board" class="view-section active">
                <div id="tracker-board"></div>
            </div>

            <!-- Deadlines View -->
            <div id="view-deadlines" class="view-section">
                <div class="toolbar">
                    <h2>Upcoming Deadlines & Reminders</h2>
                </div>
                <div class="deadlines-panel" id="upcoming-deadlines">
                    <!-- Populated by JS -->
                </div>
                <div class="deadlines-panel" id="overdue-tasks">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Analytics View -->
            <div id="view-analytics" class="view-section">
                <div class="toolbar">
                    <button class="btn btn-secondary" onclick="exportTracker.exportToCSV()">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                    <button class="btn btn-secondary" onclick="exportTracker.exportToJSON()">
                        <i class="fas fa-download"></i> Export JSON
                    </button>
                    <button class="btn btn-secondary" onclick="exportTracker.exportToExcel()">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportTracker.exportDeadlinesToICal()">
                        <i class="fas fa-calendar"></i> Export Calendar
                    </button>
                    <button class="btn btn-secondary" onclick="exportTracker.exportAnalyticsSummary()">
                        <i class="fas fa-chart-line"></i> Export Analytics
                    </button>
                    <button class="btn btn-secondary" onclick="exportTracker.printApplicationList()">
                        <i class="fas fa-print"></i> Print List
                    </button>
                </div>
                <div id="analytics-dashboard"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/tracker/storage.js"></script>
    <script src="js/tracker/analytics.js"></script>
    <script src="js/tracker/export.js"></script>
    <script src="js/tracker/board.js"></script>

    <script>
        // Initialize components
        let kanbanBoard;
        let trackerAnalytics;
        let exportTracker;

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const view = item.dataset.view;

                // Update nav
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                // Update views
                document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
                document.getElementById(`view-${view}`).classList.add('active');

                // Load view-specific data
                if (view === 'deadlines') {
                    loadDeadlines();
                } else if (view === 'analytics') {
                    loadAnalytics();
                }
            });
        });

        // Load deadlines view
        function loadDeadlines() {
            const upcomingContainer = document.getElementById('upcoming-deadlines');
            const overdueContainer = document.getElementById('overdue-tasks');

            const upcoming = trackerStorage.getUpcomingDeadlines(7);
            const overdue = trackerStorage.getOverdue();

            // Upcoming deadlines
            upcomingContainer.innerHTML = '<h3><i class="fas fa-clock"></i> Next 7 Days</h3>';
            if (upcoming.length === 0) {
                upcomingContainer.innerHTML += '<div class="empty-state">No upcoming deadlines</div>';
            } else {
                upcoming.forEach(app => {
                    const deadline = new Date(app.nextDeadline);
                    upcomingContainer.innerHTML += `
                        <div class="deadline-item">
                            <div class="deadline-info">
                                <div class="deadline-company">${app.company} - ${app.role}</div>
                                <div class="deadline-date">
                                    <i class="fas fa-calendar"></i> ${deadline.toLocaleDateString()} - ${app.nextAction || 'Action required'}
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="kanbanBoard.viewApplication('${app.id}')">View</button>
                        </div>
                    `;
                });
            }

            // Overdue tasks
            overdueContainer.innerHTML = '<h3><i class="fas fa-exclamation-triangle"></i> Overdue</h3>';
            if (overdue.length === 0) {
                overdueContainer.innerHTML += '<div class="empty-state">No overdue tasks</div>';
            } else {
                overdue.forEach(app => {
                    const deadline = new Date(app.nextDeadline);
                    const daysOverdue = Math.floor((new Date() - deadline) / (1000 * 60 * 60 * 24));
                    overdueContainer.innerHTML += `
                        <div class="deadline-item overdue">
                            <div class="deadline-info">
                                <div class="deadline-company">${app.company} - ${app.role}</div>
                                <div class="deadline-date">
                                    <i class="fas fa-exclamation-circle"></i> ${daysOverdue} days overdue - ${app.nextAction || 'Action required'}
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="kanbanBoard.viewApplication('${app.id}')">View</button>
                        </div>
                    `;
                });
            }
        }

        // Load analytics view
        function loadAnalytics() {
            trackerAnalytics.renderDashboard('analytics-dashboard');
        }

        // Handle view application event
        document.addEventListener('viewApplication', (e) => {
            const app = e.detail;
            showApplicationDetail(app);
        });

        // Handle edit application event
        document.addEventListener('editApplication', (e) => {
            const app = e.detail;
            // For now, just show detail view
            showApplicationDetail(app);
        });

        // Show application detail modal
        function showApplicationDetail(app) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content app-detail-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-briefcase"></i> Application Details</h3>
                        <button class="btn-close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
                    </div>
                    <div class="detail-body">
                        <div class="detail-section">
                            <h4>Job Information</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <div class="detail-label">Company</div>
                                    <div class="detail-value">${app.company}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Role</div>
                                    <div class="detail-value">${app.role}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Location</div>
                                    <div class="detail-value">${app.location || 'N/A'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Status</div>
                                    <div class="detail-value">${app.status}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Priority</div>
                                    <div class="detail-value">${app.priority || 'None'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Source</div>
                                    <div class="detail-value">${app.source || 'N/A'}</div>
                                </div>
                            </div>
                        </div>

                        ${app.salaryRange && (app.salaryRange.min || app.salaryRange.max) ? `
                        <div class="detail-section">
                            <h4>Compensation</h4>
                            <div class="detail-value">
                                ${app.salaryRange.currency || 'USD'}
                                ${app.salaryRange.min ? app.salaryRange.min.toLocaleString() : ''}
                                ${app.salaryRange.min && app.salaryRange.max ? '-' : ''}
                                ${app.salaryRange.max ? app.salaryRange.max.toLocaleString() : ''}
                            </div>
                        </div>
                        ` : ''}

                        ${app.jobUrl ? `
                        <div class="detail-section">
                            <h4>Job Posting</h4>
                            <a href="${app.jobUrl}" target="_blank" class="detail-value" style="color: #3b82f6;">
                                <i class="fas fa-external-link-alt"></i> View Original Posting
                            </a>
                        </div>
                        ` : ''}

                        ${app.jobDescription ? `
                        <div class="detail-section">
                            <h4>Job Description</h4>
                            <div class="detail-value" style="white-space: pre-wrap;">${app.jobDescription}</div>
                        </div>
                        ` : ''}

                        <div class="detail-section">
                            <h4>Dates</h4>
                            <div class="detail-grid">
                                ${app.appliedDate ? `
                                <div class="detail-item">
                                    <div class="detail-label">Applied</div>
                                    <div class="detail-value">${new Date(app.appliedDate).toLocaleDateString()}</div>
                                </div>
                                ` : ''}
                                <div class="detail-item">
                                    <div class="detail-label">Last Updated</div>
                                    <div class="detail-value">${new Date(app.lastUpdated).toLocaleDateString()}</div>
                                </div>
                                ${app.nextDeadline ? `
                                <div class="detail-item">
                                    <div class="detail-label">Next Deadline</div>
                                    <div class="detail-value">${new Date(app.nextDeadline).toLocaleDateString()}</div>
                                </div>
                                ` : ''}
                            </div>
                        </div>

                        ${app.nextAction ? `
                        <div class="detail-section">
                            <h4>Next Action</h4>
                            <div class="detail-value">${app.nextAction}</div>
                        </div>
                        ` : ''}

                        ${app.notes ? `
                        <div class="detail-section">
                            <h4>Notes</h4>
                            <div class="detail-value" style="white-space: pre-wrap;">${app.notes}</div>
                        </div>
                        ` : ''}

                        ${app.interviewNotes ? `
                        <div class="detail-section">
                            <h4>Interview Notes</h4>
                            <div class="detail-value" style="white-space: pre-wrap;">${app.interviewNotes}</div>
                        </div>
                        ` : ''}

                        ${app.pros && app.pros.length > 0 ? `
                        <div class="detail-section">
                            <h4>Pros</h4>
                            <ul style="padding-left: 20px; color: #10b981;">
                                ${app.pros.map(pro => `<li>${pro}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}

                        ${app.cons && app.cons.length > 0 ? `
                        <div class="detail-section">
                            <h4>Cons</h4>
                            <ul style="padding-left: 20px; color: #ef4444;">
                                ${app.cons.map(con => `<li>${con}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}

                        ${app.contacts && app.contacts.length > 0 ? `
                        <div class="detail-section">
                            <h4>Contacts</h4>
                            ${app.contacts.map(contact => `
                                <div style="padding: 8px; background: #f9fafb; border-radius: 6px; margin-bottom: 8px;">
                                    <strong>${contact.name}</strong> - ${contact.title || 'N/A'}<br>
                                    ${contact.email ? `<small>${contact.email}</small><br>` : ''}
                                    ${contact.notes ? `<small>${contact.notes}</small>` : ''}
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}

                        ${app.timeline && app.timeline.length > 0 ? `
                        <div class="detail-section">
                            <h4>Timeline</h4>
                            ${app.timeline.slice().reverse().map(event => `
                                <div class="timeline-item">
                                    <div class="timeline-date">${new Date(event.date).toLocaleDateString()} ${new Date(event.date).toLocaleTimeString()}</div>
                                    <div class="timeline-event">${event.event}</div>
                                    ${event.notes ? `<div style="font-size: 12px; color: #6b7280; margin-top: 4px;">${event.notes}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}

                        ${app.tags && app.tags.length > 0 ? `
                        <div class="detail-section">
                            <h4>Tags</h4>
                            <div class="card-tags">
                                ${app.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            // Initialize tracker
            kanbanBoard = new KanbanBoard('tracker-board', trackerStorage);
            trackerAnalytics = new TrackerAnalytics(trackerStorage);
            exportTracker = new TrackerExport(trackerStorage);

            // Add sample data if empty
            if (trackerStorage.getAll().length === 0) {
                addSampleData();
                kanbanBoard.renderAllCards();
            }
        });

        // Add sample data for testing
        function addSampleData() {
            const sampleApps = [
                {
                    company: 'Google',
                    role: 'Senior Software Engineer',
                    location: 'Mountain View, CA',
                    jobUrl: 'https://google.com',
                    jobDescription: 'We are looking for an experienced software engineer to join our team...',
                    salaryRange: { min: 150000, max: 200000, currency: 'USD' },
                    status: 'interview',
                    priority: 'high',
                    source: 'linkedin',
                    nextDeadline: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                    nextAction: 'Prepare for technical interview',
                    notes: 'Great company culture. Interviewed with hiring manager.',
                    tags: ['remote', 'cloud', 'senior'],
                    favorite: true
                },
                {
                    company: 'Microsoft',
                    role: 'Cloud Solutions Architect',
                    location: 'Redmond, WA',
                    jobUrl: 'https://microsoft.com',
                    status: 'phone-screen',
                    priority: 'high',
                    source: 'referral',
                    nextDeadline: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                    nextAction: 'Phone screen on Friday',
                    tags: ['azure', 'cloud'],
                    favorite: true
                },
                {
                    company: 'Amazon',
                    role: 'Software Development Engineer',
                    location: 'Seattle, WA',
                    status: 'applied',
                    priority: 'medium',
                    source: 'company-website',
                    tags: ['aws', 'backend']
                },
                {
                    company: 'Meta',
                    role: 'Frontend Engineer',
                    location: 'Menlo Park, CA',
                    status: 'preparing',
                    priority: 'medium',
                    source: 'linkedin',
                    notes: 'Need to tailor resume for React experience',
                    tags: ['react', 'frontend']
                },
                {
                    company: 'Apple',
                    role: 'iOS Developer',
                    location: 'Cupertino, CA',
                    status: 'saved',
                    priority: 'low',
                    source: 'indeed',
                    tags: ['ios', 'swift']
                },
                {
                    company: 'Startup XYZ',
                    role: 'Full Stack Engineer',
                    location: 'San Francisco, CA',
                    status: 'offer',
                    priority: 'high',
                    source: 'referral',
                    salaryRange: { min: 130000, max: 160000, currency: 'USD' },
                    notes: 'Great offer! Equity included.',
                    tags: ['startup', 'fullstack'],
                    favorite: true
                },
                {
                    company: 'BigCorp Inc',
                    role: 'Backend Developer',
                    location: 'New York, NY',
                    status: 'rejected',
                    priority: 'medium',
                    source: 'linkedin',
                    notes: 'Not a good culture fit'
                }
            ];

            sampleApps.forEach(app => trackerStorage.create(app));
        }
    </script>
    <script src="js/navigation/loader.js"></script>
</body>
</html>
