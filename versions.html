<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Version Management - ResuMate</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/versions.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìã ResuMate - Version Management</h1>
            <p class="tagline">Manage your resume versions and track applications</p>
            <nav style="margin-top: 1rem;">
                <a href="index.html" style="color: #3b82f6; text-decoration: none;">‚Üê Back to Home</a>
            </nav>
        </header>

        <main>
            <!-- Version Management UI Container -->
            <div id="version-ui-container"></div>
        </main>

        <footer>
            <p>Built with ‚ù§Ô∏è using Claude AI | <a href="https://github.com/ry-ops/ResuMate" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <!-- Version Management Scripts -->
    <script src="js/versions/storage.js"></script>
    <script src="js/versions/manager.js"></script>
    <script src="js/versions/diff.js"></script>
    <script src="js/versions/merger.js"></script>
    <script src="js/versions/ui.js"></script>

    <script>
        // Initialize Version Management UI
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[ResuMate] Initializing Version Management');

            // Create global instance
            window.versionUI = new VersionUI();
            window.versionUI.initialize('version-ui-container');

            console.log('[ResuMate] Version Management initialized');

            // Development helpers - add sample data if empty
            if (window.location.search.includes('demo=true')) {
                addDemoData();
            }
        });

        // Demo data function for testing
        function addDemoData() {
            console.log('[Demo] Adding sample version data');

            const manager = window.versionUI.versionManager;

            // Create base resumes
            const base1 = manager.createBaseVersion({
                name: 'Software Engineer Resume',
                templateId: 'modern',
                notes: 'Main resume for software engineering positions',
                resumeData: {
                    personal: {
                        name: 'John Doe',
                        email: 'john@example.com',
                        phone: '555-0123'
                    },
                    summary: 'Experienced software engineer with 5+ years in full-stack development',
                    experience: [
                        {
                            title: 'Senior Software Engineer',
                            company: 'Tech Corp',
                            duration: '2020 - Present',
                            description: 'Led development of cloud-native applications'
                        },
                        {
                            title: 'Software Engineer',
                            company: 'StartUp Inc',
                            duration: '2018 - 2020',
                            description: 'Built scalable web applications'
                        }
                    ],
                    skills: ['JavaScript', 'Python', 'React', 'Node.js', 'AWS']
                },
                tags: ['engineering', 'full-stack']
            });

            const base2 = manager.createBaseVersion({
                name: 'Data Science Resume',
                templateId: 'classic',
                notes: 'Resume for data science and ML positions',
                resumeData: {
                    personal: {
                        name: 'Jane Smith',
                        email: 'jane@example.com',
                        phone: '555-0456'
                    },
                    summary: 'Data scientist with expertise in machine learning and analytics',
                    experience: [
                        {
                            title: 'Data Scientist',
                            company: 'Data Corp',
                            duration: '2019 - Present',
                            description: 'Built ML models for predictive analytics'
                        }
                    ],
                    skills: ['Python', 'R', 'TensorFlow', 'SQL', 'Tableau']
                },
                tags: ['data-science', 'ml']
            });

            // Create tailored versions
            const tailored1 = manager.createTailoredVersion(base1.id, {
                targetCompany: 'Anthropic',
                targetRole: 'Senior Software Engineer',
                jobDescription: 'We are looking for an experienced engineer to work on AI systems...',
                jobUrl: 'https://anthropic.com/careers',
                tags: ['ai', 'remote']
            });

            manager.updateStatus(tailored1.id, 'applied');

            const tailored2 = manager.createTailoredVersion(base1.id, {
                targetCompany: 'Google',
                targetRole: 'Staff Software Engineer',
                jobDescription: 'Join our team working on distributed systems...',
                jobUrl: 'https://careers.google.com',
                tags: ['distributed-systems']
            });

            manager.updateStatus(tailored2.id, 'interviewing');

            const tailored3 = manager.createTailoredVersion(base1.id, {
                targetCompany: 'Meta',
                targetRole: 'Senior Frontend Engineer',
                jobDescription: 'Build next-generation social experiences...',
                tags: ['frontend', 'react']
            });

            const tailored4 = manager.createTailoredVersion(base2.id, {
                targetCompany: 'OpenAI',
                targetRole: 'Research Engineer',
                jobDescription: 'Work on cutting-edge AI research...',
                jobUrl: 'https://openai.com/careers',
                tags: ['research', 'ml']
            });

            manager.updateStatus(tailored4.id, 'offer');
            manager.toggleFavorite(tailored4.id);

            console.log('[Demo] Sample data added successfully');
            window.versionUI.render();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + N: New base resume
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                window.versionUI.showCreateBaseModal();
            }

            // Ctrl/Cmd + F: Focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                const searchInput = document.getElementById('version-search');
                if (searchInput) searchInput.focus();
            }

            // Escape: Close modal
            if (e.key === 'Escape') {
                window.versionUI.closeModal();
            }
        });

        // Test functions for development
        function testVersionManagement() {
            console.group('[Test] Version Management');

            const manager = window.versionUI.versionManager;

            // Test 1: Create base version
            console.log('Test 1: Create base version');
            const base = manager.createBaseVersion({
                name: 'Test Base Resume',
                templateId: 'modern',
                notes: 'Test notes',
                resumeData: { test: true }
            });
            console.log('Created:', base);

            // Test 2: Create tailored version
            console.log('Test 2: Create tailored version');
            const tailored = manager.createTailoredVersion(base.id, {
                targetCompany: 'Test Company',
                targetRole: 'Test Role',
                jobDescription: 'Test job description'
            });
            console.log('Created:', tailored);

            // Test 3: Clone version
            console.log('Test 3: Clone version');
            const cloned = manager.cloneVersion(base.id);
            console.log('Cloned:', cloned);

            // Test 4: Update status
            console.log('Test 4: Update status');
            manager.updateStatus(tailored.id, 'applied');
            const updated = manager.getVersion(tailored.id);
            console.log('Updated:', updated);

            // Test 5: Get version tree
            console.log('Test 5: Get version tree');
            const tree = manager.getVersionTree();
            console.log('Tree:', tree);

            // Test 6: Search versions
            console.log('Test 6: Search versions');
            const results = manager.searchVersions('test');
            console.log('Search results:', results);

            // Test 7: Compare versions
            console.log('Test 7: Compare versions');
            const diff = window.versionUI.versionDiff;
            const comparison = diff.compareVersions(base, tailored);
            console.log('Comparison:', comparison);

            // Test 8: Statistics
            console.log('Test 8: Statistics');
            const stats = manager.getStatistics();
            console.log('Statistics:', stats);

            console.groupEnd();
        }

        // Make test function available in console
        window.testVersionManagement = testVersionManagement;
        console.log('[ResuMate] Test function available: testVersionManagement()');
        console.log('[ResuMate] Add demo data: window.location.href += "?demo=true"');
    </script>
</body>
</html>
